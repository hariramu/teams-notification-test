name: Build and Deploy UI -- Prod

on:
  push:
    branches: [ main ]

env:
  ENVIRONMENT: UAT
  RUNNER_NAME: loraxui-prod

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Build step
        run: |
          echo "Building UI..."
          sleep 2

      - name: Deploy step
        run: |
          echo "Deploying to $ENVIRONMENT..."
          sleep 2

      - name: Send Teams Notification
        if: always()
        run: |
          STATUS="SUCCESS"
          COLOR="00FF00"

          if [ "${{ job.status }}" != "success" ]; then
            STATUS="FAILED"
            COLOR="FF0000"
          fi

          curl -H "Content-Type: application/json" -d "{
            \"@type\": \"MessageCard\",
            \"@context\": \"http://schema.org/extensions\",
            \"themeColor\": \"${COLOR}\",
            \"summary\": \"GitHub Actions - ${{ github.repository }}\",
            \"title\": \"GitHub Actions - ${{ github.repository }}\",
            \"sections\": [{
              \"facts\": [
                {\"name\": \"Workflow\", \"value\": \"${{ github.workflow }}\"},
                {\"name\": \"Environment\", \"value\": \"${ENVIRONMENT}\"},
                {\"name\": \"Branch\", \"value\": \"${{ github.ref_name }}\"},
                {\"name\": \"Commit\", \"value\": \"${{ github.sha }}\"},
                {\"name\": \"Status\", \"value\": \"${STATUS}\"},
                {\"name\": \"Runner\", \"value\": \"${RUNNER_NAME}\"}
              ],
              \"markdown\": true
            }],
            \"potentialAction\": [{
              \"@type\": \"OpenUri\",
              \"name\": \"View Workflow Run\",
              \"targets\": [{
                \"os\": \"default\",
                \"uri\": \"${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\"
              }]
            }]
          }" ${{ secrets.TEAMS_WEBHOOK_URL }}
